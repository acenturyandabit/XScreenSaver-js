<!DOCTYPE HTML>
<!-- UnknownPleasures -->
<!-- Based off of: http://intothecontinuum.tumblr.com/post/27443100682/in-july-1967-astronomers-at-the-cavendish -->
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <style>
      html,body {
        margin: 0px;
        padding: 0px;
          background-color:#000;
      }

    </style>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>
    <script>


      var R = function(n) {
        var r = Math.floor(Math.random() * n);
        //console.log(r);
        return r;
      }


      Hack.prototype.clear = function(config) {
        var context = this.context;
        this.canvas.style.backgroundColor = config.background;
        context.clearRect(0, 0, this.canvas.width, this.canvas.height);
      }


      Hack.prototype.getPixel = function(x,y) {
        //if (typeof this.cells[x] === 'undefined') { alert(x+".."+y);}
        return (this.cells[x][y]) == 1;
      }
      Hack.prototype.setPixel = function (x,y) {
        if(x<0 || x >= this.width || y < 0 || y>=this.height) {}
        else {
          this.cells[x][y] = 1;
        }
      }
      Hack.prototype.drawPixel = function (x,y) {
        this.context.fillStyle = "rgba("+(Math.floor(this.nwalkers*255/this.maxwalkers))+","+255+","+(255-Math.floor(this.nwalkers*255/this.maxwalkers))+","+(255/255)+")";
        pixel = 1;
        this.context.fillRect( pixel*x, pixel*y, pixel, pixel );
        /*
        var id = this.context.createImageData(1,1); // only do this once per page
        var d  = id.data;                        // only do this once per page
        d[0]   = 255;
        d[1]   = 255;
        d[2]   = 255;
        d[3]   = 255;
        this.context.putImageData( id, x, y ); 
        */
      }

      Hack.prototype.configure = function() {
        config = this.config;
        this.canvas = document.getElementById(config.canvasId);
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight-10;
        this.width = config.width;
        this.height = config.height;
        this.context = this.canvas.getContext('2d');
        this.scaleX = this.canvas.width / this.width;
        this.scaleY = this.canvas.height / this.height;
        

        this.cells = [];
        for (var i=0; i<config.height; i++) {
          this.cells[i] = [];
          for (var j=0; j<config.width; j++) {
            this.cells[i][j] = 0;
          }
        }

	this.seeds = 30;
	for( var i = 0; i < this.seeds; i++ ) {
	    var x, y;
	    do {
	      x = 1 + R(this.width - 2);
	      y = 1 + R(this.height - 2);
	    } while( this.getPixel(x, y));

	    this.setPixel((x-1), (y-1)); this.setPixel(x, (y-1)); this.setPixel((x+1), (y-1));
	    this.setPixel((x-1),  y   ); this.setPixel(x,  y   ); this.setPixel((x+1),  y   );
	    this.setPixel((x-1), (y+1)); this.setPixel(x, (y+1)); this.setPixel((x+1), (y+1));
            this.drawPixel(x,y);
	}


        this.nwalkers = this.width*this.height*30/100;
        this.maxwalkers = this.nwalkers;
        this.walkers = [];
        for( var i = 0; i < this.nwalkers; i++ ) {
          this.walkers[i] = {x: R(this.width), y: R(this.height)};
        }
        this.ncolors=1;
        this.npoints = 0;
        //this.max_points = 10;
        //this.pointsbuf = [];
        //for (var i=0; i<this.max_points+2; i++) {
        //  this.pointsbuf[i]={x:0,y:0};
        //}
        this.colorsloth = this.nwalkers*2/this.ncolors;
        //console.log(this.cells);
        this.clear(config);

      }

      function Hack(config) {
        this.config = config;
        this.configure();
      }



      var t = 0.0;
      var m = 1;
      var config = {
      };

      var runner = function() {
        if(hack.nwalkers==0) {
          hack.configure();
          return;
        }
        var i = 0;
        for(var i=0; i<hack.nwalkers;i++) {
          var x = hack.walkers[i].x;
          var y = hack.walkers[i].y;
          //console.log(hack.walkers[i]);
          if(hack.getPixel(x,y)) {
            //console.log(hack.walkers[i]);
            var color = false;

            // Do something
            //hack.pointsbuf[hack.npoints].x=x;
            //hack.pointsbuf[hack.npoints].y=y;
            //hack.npoints++;
            hack.drawPixel(x,y);

            hack.setPixel(x-1,y-1); hack.setPixel(x,y-1); hack.setPixel(x+1,y-1); 
            hack.setPixel(x-1,y);                         hack.setPixel(x+1,y); 
            hack.setPixel(x-1,y+1); hack.setPixel(x,y+1); hack.setPixel(x+1,y+1); 
            hack.nwalkers--;
            hack.walkers[i].x = hack.walkers[hack.nwalkers].x;
            hack.walkers[i].y = hack.walkers[hack.nwalkers].y;
            
            if( 0 == ((hack.colorsloth ? hack.nwalkers%hack.colorsloth : 0))) {
              color = true;
            }

            //if(color || 0 == hack.nwalkers || hack.npoints >= hack.max_points) {
            //  for(var i = 0; i<hack.npoints; i++) {
            //    hack.drawPixel(hack.pointsbuf[i].x,hack.pointsbuf[i].y);
            //  }
            //  hack.npoints = 0;
            //}

            if(color) {
              //
            }


          } else {

            do {
              switch(R(4)) {
                  case 0:
                    if(x<=1) {
                      hack.walkers[i].x++;
                      break;
                    }
                    hack.walkers[i].x--;
                    break;
                  case 1:
            if(x>=hack.width-2) {
                      hack.walkers[i].x--;
                      break;
            }
                    hack.walkers[i].x++;
                    break;
                  case 2:
                    if(y<=1) {
                      hack.walkers[i].y++;
                      break;
            }
                    hack.walkers[i].y--;
                    break;
                  default:
            if(y>=hack.height-2) {
                      hack.walkers[i].y--;
                      break;
            }
                    hack.walkers[i].y++;
                    break;
              }
            } while(0);

          }
        }
        //console.log(hack.walkers[0].x+","+hack.walkers[0].y+"....."+hack.getPixel(hack.walkers[0].x,hack.walkers[0].y));
      }

    window.onload = function() {
      var gui = new dat.GUI();
    };

      var hack = new Hack({
        canvasId: 'myCanvas',
        height: window.innerHeight-10,
        width: 700,
      });


    var t=setInterval(runner,33);

    </script>
  </body>
</html>
